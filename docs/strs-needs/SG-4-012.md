# SG-4-012 â€” Developers

- Stakeholder Group: Developers
- Need: The system shall support multiple university instances, each with their own LRS API endpoints, while providing both per-instance analytics and global cross-instance analytics aggregation.
- Rationale: The HASKI system serves multiple universities with separate Moodle/LRS/Frontend/Backend ... deployments. Analytics must be available both at the individual university level and aggregated across all universities for comparative insights.
- Outcome: The system can query multiple LRS endpoints, identify the source instance from xAPI statements, and provide analytics filtered by instance or aggregated globally.
- Acceptance Criteria:
  - System configuration supports multiple LRS endpoints (URLs, credentials) mapped to university instance identifiers.
  - Instance identification: The system extracts the university instance from xAPI statement context (e.g., from `context.platform`, `context.extensions["https://wiki.haski.app/"].domain`, or `context.contextActivities.parent.id`).
  - Each xAPI statement is tagged/stored with its source instance identifier during ingestion.
  - API endpoints support filtering by instance: `?instanceId=HS-KE` returns analytics for that university only.
  - API endpoints support global aggregation: omitting `instanceId` or using `?instanceId=*` returns cross-instance aggregated analytics.
  - Per-instance analytics are isolated: students/courses from one instance do not appear in another instance's results unless explicitly requested via global aggregation.
  - Instance metadata is exposed via an API endpoint (e.g., GET `/instances`) listing configured instances with identifiers and names.
  - Documentation specifies the xAPI context fields used for instance extraction and how to configure multiple LRS connections.
  - Tests verify correct instance tagging, filtering, and global aggregation using mock data from multiple instances.
- Priority: High
- Assumptions: Each university's LRS is xAPI-compliant; instance identifier appears consistently in xAPI statements; no cross-instance student identity resolution is required (students are scoped to their instance); configuration provides mapping from instance identifiers to LRS endpoints and authentication.

