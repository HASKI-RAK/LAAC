# ===================================================================
# LAAC Environment Configuration (REQ-FN-014)
# ===================================================================
# Copy this file to .env for local development
# For production, use Docker secrets or Portainer environment variables
# NEVER commit actual secrets to the repository
# ===================================================================

# ===================================================================
# Application Configuration
# ===================================================================

# Application environment: development, production, or test
NODE_ENV=development

# Port the application listens on
PORT=3000

# API route prefix for versioning (e.g., /api/v1/metrics)
API_PREFIX=api/v1

# Enable/disable Swagger UI and OpenAPI documentation
# Set to false to disable in production environments
# Default: true (Swagger enabled)
SWAGGER_ENABLED=true

# ===================================================================
# JWT Authentication Configuration (REQ-FN-023)
# ===================================================================

# JWT signing secret - REQUIRED
# Generate with: openssl rand -base64 32
# SECURITY: Must be at least 32 characters in production
# SECURITY: Keep this secret and never commit to repository
JWT_SECRET=your-secret-key-min-32-chars-replace-in-production

# JWT token expiration time
# Format: <number><unit> where unit is s(seconds), m(minutes), h(hours), d(days)
# Examples: 30m, 1h, 7d
JWT_EXPIRATION=1h

# Enable/disable authentication
# Set to false for development/testing to bypass authentication
# Default: true (authentication enabled)
AUTH_ENABLED=true

# ===================================================================
# Redis Cache Configuration (REQ-FN-006)
# ===================================================================

# Redis server hostname or IP
REDIS_HOST=localhost

# Redis server port
REDIS_PORT=6379

# Redis authentication password (optional)
# SECURITY: Keep this secret if used
# Leave empty or omit if Redis has no authentication
REDIS_PASSWORD=

# Default cache TTL (Time To Live) in seconds
# Default: 3600 (1 hour)
REDIS_TTL=3600

# Cache TTL for metrics catalog in seconds (REQ-FN-006)
# Default: 3600 (1 hour)
CACHE_TTL_METRICS=3600

# Cache TTL for metric computation results in seconds (REQ-FN-006)
# Default: 300 (5 minutes)
CACHE_TTL_RESULTS=300

# Cache TTL for health check data in seconds (REQ-FN-006)
# Default: 60 (1 minute)
CACHE_TTL_HEALTH=60

# Maximum Redis connection pool size (REQ-FN-006)
# Default: 10
REDIS_POOL_SIZE=10

# ===================================================================
# LRS (Learning Record Store) Configuration (REQ-FN-002, REQ-FN-026)
# ===================================================================

# Multi-LRS configuration using JSON array (preferred)
# IMPORTANT: Replace placeholder credentials below with your secrets via
#            environment injection or Docker secrets in production.
#            Do NOT commit real secrets to source control.
#
# Schema per REQ-FN-026:
# LRS_INSTANCES='[
#   {"id":"hs-ke","name":"HS Kempten","endpoint":"https://ke.lrs.example/xapi",
#    "timeoutMs":10000,
#    "auth":{"type":"basic","username":"<apiKey>","password":"<apiSecret>"}},
#   {"id":"hs-rv","name":"HS Ravensburg","endpoint":"https://rv.lrs.example/xapi",
#    "auth":{"type":"basic","key":"<apiKey2>","secret":"<apiSecret2>"}}
# ]'

LRS_INSTANCES='[{"id":"hs-ke","name":"HS Kempten","endpoint":"https://ke.lrs.example/xapi","timeoutMs":10000,"auth":{"type":"basic","username":"<apiKey>","password":"<apiSecret>"}},{"id":"hs-rv","name":"HS Aschaffenburg","endpoint":"https://rv.lrs.example/xapi","auth":{"type":"basic","key":"<apiKey2>","secret":"<apiSecret2>"}}]'

# Alternative per-instance prefixed variables (use if JSON envs are impractical)
# LRS_HS_KE_ENDPOINT=https://ke.lrs.example/xapi
# LRS_HS_KE_AUTH_TYPE=basic
# LRS_HS_KE_USERNAME=<apiKey>
# LRS_HS_KE_PASSWORD=<apiSecret>
# LRS_HS_KE_TIMEOUT_MS=10000

LRS_URL=
LRS_API_KEY=
LRS_TIMEOUT=

# ===================================================================
# Logging Configuration (REQ-FN-020)
# ===================================================================

# Application log level
# Options: error, warn, log, debug, verbose
# Default: log
# Recommendation: Use 'log' for production, 'debug' or 'verbose' for development
LOG_LEVEL=log

# ===================================================================
# Docker & Deployment Configuration (REQ-FN-013)
# ===================================================================

# Docker Registry URL for production image
# Example: ghcr.io/haski-rak/laac (GitHub Container Registry)
# Used in docker-compose.yml for pulling production images
DOCKER_REGISTRY_URL=ghcr.io/haski-rak/laac

# Docker image tag to use in production
# Example: latest, v1.0.0, main-abc1234
# Set by CI/CD pipeline or manually for deployment
IMAGE_TAG=latest

# Traefik Routing Configuration (Production Only)
# Subdomain for the application (e.g., laac, api, analytics)
SUBDOMAIN=laac

# Domain name for Traefik routing (e.g., example.com)
# Full URL will be: ${SUBDOMAIN}.${DOMAIN_NAME}
DOMAIN_NAME=example.com

# Generic timezone for the container
# Used for log timestamps and scheduled tasks
# Example: Europe/Berlin, America/New_York, UTC
GENERIC_TIMEZONE=Europe/Berlin

# ===================================================================
# Rate Limiting Configuration (REQ-FN-024)
# ===================================================================

# Rate limit time window in seconds
# Default: 60 (1 minute)
# This is the time window for counting requests
RATE_LIMIT_TTL=60

# Maximum requests per time window
# Default: 100 requests per minute
# This applies to all endpoints unless overridden by endpoint-specific limits
RATE_LIMIT_MAX=100

# ===================================================================
# Circuit Breaker Configuration (REQ-FN-017)
# ===================================================================

# Number of consecutive failures before opening circuit
# Default: 5
CIRCUIT_BREAKER_THRESHOLD=5

# Timeout in milliseconds before attempting recovery
# Default: 30000 (30 seconds)
# Minimum: 5000ms recommended for production
CIRCUIT_BREAKER_TIMEOUT=30000

# Number of successful test requests required to close circuit
# Default: 1
CIRCUIT_BREAKER_HALF_OPEN_REQUESTS=1

# ===================================================================
# Graceful Degradation Configuration (REQ-NF-003)
# ===================================================================

# Enable graceful degradation strategies
# Default: true
# When enabled, system returns cached/stale data or null results instead of errors
GRACEFUL_DEGRADATION_ENABLED=true

# Enable cache fallback with stale data when LRS unavailable
# Default: true
# When enabled, system returns stale cached data with warning flag
CACHE_FALLBACK_ENABLED=true

# Intended maximum age for stale cache data in seconds
# Default: 86400 (24 hours)
# Note: Age validation not currently enforced; all stale cache data is returned
STALE_DATA_TTL=86400

# Default value to return when data unavailable
# Default: null
# Options: null, 0, or any JSON value
DEFAULT_VALUE_ON_UNAVAILABLE=null

# ===================================================================
# Additional Notes
# ===================================================================
# - All values above are defaults suitable for local development
# - For production deployment:
#   1. Generate secure JWT_SECRET with: openssl rand -base64 32
#   2. Set actual LRS_URL and LRS_API_KEY from your LRS provider
#   3. Configure REDIS_PASSWORD if Redis authentication is enabled
#   4. Set NODE_ENV=production
#   Note: Use Docker secrets or environment injection (never .env files in production)
#   6. Set DOCKER_REGISTRY_URL to your container registry
#   7. Use Docker secrets or environment injection (never .env files in production)
# - See docs/architecture/ARCHITECTURE.md Section 5.3 for more details
# - Docker Compose startup:
#   - Development: docker compose -f docker-compose.dev.yml up
#   - Production: docker compose up -d
# - See docs/architecture/ARCHITECTURE.md Section 5.3 for more details
# ===================================================================
